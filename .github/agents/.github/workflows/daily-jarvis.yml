name: Lady Jarvis Daily Check

on:
  schedule:
    - cron: '0 14 * * *' # Runs every day at 7am MST (14:00 UTC)
  workflow_dispatch: # Allows manual run

jobs:
  daily_scan:
    name: â˜€ï¸ Smoother, Sharper, Slicker Scan
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“¥ Checkout Code
        uses: actions/checkout@v4

      - name: ğŸŸ¢ Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: ğŸ“¦ Install Playwright & Deps
        run: |
          npm ci
          npx playwright install --with-deps

      - name: ğŸ­ Run Playwright "Smoothness" Check
        run: npx playwright test
        continue-on-error: true # Report failures, don't crash

      - name: ğŸ§  Lady Jarvis Memory Check
        uses: actions/github-script@v7
        with:
          script: |
            // This script acts as her "Memory" by checking past reports
            const issues = await github.rest.issues.listForRepo({
              owner: context.repo.owner,
              repo: context.repo.repo,
              state: 'all',
              labels: ['lady-jarvis-report']
            });
            
            // Logic to see if we are improving or getting worse
            console.log(`Found ${issues.data.length} past reports.`);

      - name: ğŸ“ Post Daily ROI Report
        uses: actions/github-script@v7
        with:
          script: |
            await github.rest.issues.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: `â˜€ï¸ Lady Jarvis Report: ${new Date().toISOString().split('T')[0]}`,
              labels: ['lady-jarvis-report'],
              body: `### ğŸ¯ Daily Optimization Report
              **Goal:** Smoother, Sharper, Slicker.
              
              - **Playwright Status:** (Check Actions Log)
              - **Bloat Check:** Running analysis...
              
              *I have checked the code. If any critical paths are slow, I have flagged them above.*`
            });
